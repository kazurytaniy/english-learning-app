# English Learning Cards - 完全仕様書

## 📋 プロジェクト概要

### 目的
エビングハウスの忘却曲線を活用し、効率的な英語学習を実現するWebアプリケーション

### ターゲットユーザー
個人学習者（自分専用）

### 技術スタック
- React 18 + Vite
- Tailwind CSS
- Recharts (グラフ描画)
- Lucide React (アイコン)
- Persistent Storage API (データ永続化)

---

## 🎯 機能要件

### 1. 単語・慣用句管理

#### 1.1 データ構造
```javascript
{
  // 基本情報
  id: String (UUID),
  english: String (最大200文字),
  japanese: Array<String> (複数訳対応、合計最大500文字),
  primaryMeaning: String (カード学習用のメイン訳),
  category: "word" | "idiom" | "phrase",
  
  // 追加情報
  example: String (最大500文字),
  note: String (最大2000文字),
  tags: Array<String> (最大10個、各20文字),
  
  // ステータス（5段階）
  status: "まだまだ" | "聞ける" | "話せる" | "書ける" | "マスター",
  
  // 学習データ
  createdAt: String (ISO日付),
  reviewHistory: Array<ReviewRecord>,
  nextReviewDate: String (YYYY-MM-DD),
  lastReviewDate: String (YYYY-MM-DD),
  correctCount: Number,
  incorrectCount: Number,
  currentInterval: Number (日数),
  totalReviewCount: Number,
  averageResponseTime: Number (ミリ秒),
  consecutiveCorrect: Number,
  masteryProgress: Number (0-100)
}

ReviewRecord {
  date: String (YYYY-MM-DD),
  mode: "english-to-japanese" | "japanese-to-english",
  result: Boolean,
  responseTime: Number (ミリ秒),
  interval: Number (日数)
}
```

#### 1.2 登録機能
- 必須項目: 英語、日本語訳（最低1つ）、カテゴリ
- オプション: 例文、メモ、タグ、ステータス
- 複数訳の追加・削除（最大5つ）
- メイン訳の選択（複数訳がある場合）
- バリデーション: 文字数制限チェック

#### 1.3 編集・削除機能
- 既存単語の編集
- 削除前の確認ダイアログ
- 削除取り消し不可の警告

#### 1.4 一覧・検索機能
- 全単語の一覧表示
- キーワード検索（英語・日本語両方）
- カテゴリフィルター
- ステータスフィルター
- 次回復習日の表示

---

### 2. 学習機能

#### 2.1 学習モード
1. **英語 → 日本語**: 英語を見て日本語を答える
2. **日本語 → 英語**: 日本語を見て英語を答える
3. **ランダム**: カードごとにランダムで切り替え

#### 2.2 学習フロー
1. 学習モードを選択
2. 今日学習すべき単語を取得
3. カード表示（問題面）
4. タップでカード反転（答え面）
5. 複数訳がある場合は「他の意味を見る」で展開可能
6. ○×ボタンで自己採点
7. 次のカードへ
8. 全て完了したら結果画面へ

#### 2.3 今日学習すべき単語の判定
- nextReviewDateがnull（未学習）の単語
- nextReviewDateが今日以前の単語
- ソート順: nextReviewDate昇順 → 作成日昇順

#### 2.4 自己採点処理
**正解の場合:**
- correctCountを+1
- consecutiveCorrectを+1
- 復習間隔を延長（次の間隔へ）
- nextReviewDateを更新
- ステータスを自動更新（マスター度による）

**不正解の場合:**
- incorrectCountを+1
- consecutiveCorrectを0にリセット
- 復習間隔を1日にリセット
- nextReviewDateを明日に設定
- ステータスを自動更新

#### 2.5 回答時間の記録
- カード表示からタップまでの時間を記録
- 平均回答時間を計算
- 統計表示に使用

---

### 3. エビングハウス復習アルゴリズム

#### 3.1 デフォルト設定（パターンB）
```javascript
intervals = [1, 2, 4, 7, 14, 30, 60, 90, 120, 180]
```

#### 3.2 アルゴリズム
```
正解時:
  現在の間隔のインデックスを取得
  次のインデックスの間隔を適用
  最後の間隔を超えた場合: 最後の間隔 × 1.5

不正解時:
  intervals[0]（1日）にリセット
```

#### 3.3 カスタマイズ
- 設定画面で間隔配列を編集可能
- 追加・削除・並び替え
- デフォルトに戻す機能

---

### 4. 間違い単語リスト機能

#### 4.1 表示タイミング
学習セッション完了後

#### 4.2 フォーマット

**シンプル形式:**
```
take a rain check / また今度にする
break the ice / 打ち解ける
```

**AI学習用形式:**
```
以下の英語表現を覚えるための効果的な学習方法を教えてください:

1. take a rain check
   意味: また今度にする

2. break the ice
   意味: 打ち解ける
```

**CSV形式:**
```
English,Japanese
take a rain check,また今度にする
break the ice,打ち解ける
```

#### 4.3 コピー機能
- ワンクリックでクリップボードにコピー
- コピー成功時の確認メッセージ
- AI学習への誘導テキスト

---

### 5. 統計・可視化機能

#### 5.1 基本統計（必須）
- 今日学習した件数
- 今日の正答率
- 総登録単語数
- 全体正答率
- 平均回答時間

#### 5.2 週間学習グラフ
- 過去7日間の学習件数を棒グラフで表示
- 日付・曜日表示
- ツールチップで詳細表示

#### 5.3 正答率推移グラフ
- 過去30日間の正答率を折れ線グラフで表示
- 学習がない日はスキップ
- Y軸: 0-100%

#### 5.4 苦手な単語TOP10
- 誤答率の高い順にソート
- 英語・日本語・誤答率を表示
- タップで詳細表示（将来実装）

#### 5.5 ステータス別分布
- 5段階のステータスごとの単語数
- パーセンテージ表示
- プログレスバーで可視化

#### 5.6 カテゴリ別習得状況
- 単語・慣用句・フレーズごとのマスター率
- マスター数 / 総数を表示

#### 5.7 カレンダーヒートマップ
- 過去90日間の学習履歴
- 色の濃淡で学習量を表現
- ホバーで日付と件数を表示

---

### 6. モチベーション機能

#### 6.1 学習ストリーク
- 連続学習日数をカウント
- 現在のストリークと最長記録を表示
- 🔥アイコンで強調

#### 6.2 レベル・経験値システム
```javascript
経験値の獲得:
- 単語登録: 10 XP
- 学習1回: 5 XP
- マスター度1%: 1 XP

レベル計算:
LEVEL_XP_TABLE = [0, 100, 250, 450, 700, 1000, ...]
現在のXPがテーブルのどこに該当するかでレベル決定
```

#### 6.3 バッジシステム
```javascript
バッジ例:
- 初めの一歩: 最初の単語を登録
- 単語コレクター: 10語登録
- 1週間継続: 7日連続学習
- 精度マスター: 正答率90%以上
- 10語マスター: 10語をマスター
```

#### 6.4 やる気スコア（0-100点）
```javascript
計算式:
ストリーク要素 (0-30点):
  min(連続日数 / 30 * 30, 30)

最近の正答率 (0-25点):
  今日の正答率 / 100 * 25

学習の一貫性 (0-25点):
  過去7日の学習日数 / 7 * 25

チャレンジ受容度 (0-20点):
  「まだまだ」の単語数 / 総単語数 * 20
```

#### 6.5 学習時間トラッキング
- 総学習時間
- 平均セッション時間
- 統計画面で表示

---

### 7. 設定機能

#### 7.1 学習設定
- デフォルト学習モード
- 1日の目標件数
- 通知設定（将来実装）

#### 7.2 復習間隔カスタマイズ
- 間隔配列の編集
- 追加・削除
- デフォルトに戻す

#### 7.3 データ管理
**エクスポート:**
- JSON形式（完全なバックアップ）
- CSV形式（表計算ソフト用）

**インポート:**
- 将来実装

**削除:**
- 全データ削除
- 確認ダイアログ2段階

---

### 8. データ永続化

#### 8.1 Persistent Storage API
```javascript
ストレージキー:
- words: 単語データ配列
- settings: 設定データ
- study-calendar: 学習カレンダー
- badges: アンロック済みバッジ

制限:
- 1キーあたり最大5MB
- ブラウザ依存
```

#### 8.2 学習カレンダーデータ
```javascript
{
  "2024-12-21": {
    count: 15,    // 学習件数
    correct: 12   // 正解数
  },
  "2024-12-22": { ... }
}
```

---

## 🎨 UI/UX設計

### 画面構成

#### ホーム画面
- 学習ストリーク表示
- やる気スコア
- 今日の学習カード
- クイックアクション（単語追加、単語帳、統計）
- 今日の統計サマリー

#### 単語帳画面
- 検索バー
- カテゴリ・ステータスフィルター
- 単語一覧（カード形式）
- 編集・削除ボタン

#### 学習画面
- プログレスバー
- カード（タップで反転）
- 複数訳の展開ボタン
- ○×採点ボタン
- 途中経過表示

#### 完了画面
- 結果サマリー
- 間違い単語リスト
- フォーマット選択
- コピーボタン
- ホームに戻るボタン

#### 統計画面
- レベル表示
- 主要統計カード
- 週間グラフ
- 正答率推移
- ステータス分布
- カレンダーヒートマップ
- 苦手単語TOP10
- バッジコレクション
- カテゴリ別習得状況

#### 設定画面
- 学習設定
- 復習間隔カスタマイズ
- データ管理
- アプリ情報

### ボトムナビゲーション
- ホーム
- 単語帳
- 統計
- 設定

学習中は非表示

---

## 🔧 技術的詳細

### 状態管理
- カスタムフックによる状態管理
- useWords: 単語データ管理
- useStudyCalendar: 学習カレンダー管理
- useSettings: 設定管理
- useBadges: バッジ管理

### パフォーマンス最適化
- コンポーネントの遅延読み込み
- メモ化（useMemo, useCallback）
- 大量データの仮想化（将来実装）

### レスポンシブデザイン
- モバイルファースト
- Tailwindのブレークポイント活用
- タッチ操作に最適化

---

## 📱 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**注意**: Persistent Storage APIをサポートするブラウザが必要

---

## 🚀 今後の拡張案

### Phase 2
- PWA対応（オフライン利用）
- 音声読み上げ機能
- 画像付き単語登録

### Phase 3
- バックエンドAPI構築
- マルチデバイス同期
- クラウドバックアップ

### Phase 4
- AI自動採点
- 発音チェック
- 学習推奨アルゴリズム

---

## 📄 開発ガイドライン

### コーディング規約
- ES6+構文使用
- 関数コンポーネント優先
- PropTypes（型チェック）
- ESLint準拠

### コミットメッセージ
```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: コード整形
refactor: リファクタリング
test: テスト追加
chore: ビルド・設定変更
```

### ブランチ戦略
```
main: 本番環境
develop: 開発環境
feature/*: 機能開発
hotfix/*: 緊急修正
```

---

この仕様書は v1.0 の完全版です。
実装時は随時更新してください。
